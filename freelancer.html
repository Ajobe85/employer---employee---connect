<!DOCTYPE html>
<html>
<head>
    <title>Freelancer Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="firebase.js"></script>
</head>
<body>
    <div class="dashboard">
        <h1>Welcome Freelancer</h1>
        <div class="job-listings" id="jobListings">
            <!-- Jobs will load here -->
        </div>
    </div>

    <script>
        // Initialize Firebase
        const auth = firebase.auth();
        const database = firebase.database();

        // Check authentication state
        auth.onAuthStateChanged(user => {
            if (!user) {
                window.location.href = 'auth.html';
            } else {
                loadJobs();
            }
        });

        // Load jobs from Firebase
        function loadJobs() {
            database.ref('jobs').on('value', snapshot => {
                const jobs = snapshot.val();
                const container = document.getElementById('jobListings');
                container.innerHTML = '';

                if (!jobs) {
                    container.innerHTML = '<p>No available jobs at the moment. Check back later!</p>';
                    return;
                }

                Object.keys(jobs).forEach(jobId => {
                    const job = jobs[jobId];
                    container.innerHTML += `
                        <div class="job-card">
                            <h3>${job.title}</h3>
                            <p>${job.description}</p>
                            <p>Posted: ${new Date(job.timestamp).toLocaleDateString()}</p>
                            <button onclick="applyForJob('${jobId}')">Apply Now</button>
                        </div>
                    `;
                });
            });
        }

        // Apply for job functionality
        async function applyForJob(jobId) {
            try {
                const user = auth.currentUser;
                await database.ref(`applications/${jobId}`).push({
                    freelancerId: user.uid,
                    appliedAt: Date.now(),
                    status: "pending"
                });
                alert('Application submitted successfully!');
            } catch (error) {
                alert('Error submitting application: ' + error.message);
            }
        }
    </script>
</body>
</html>
